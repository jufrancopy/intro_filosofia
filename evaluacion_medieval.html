<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluación: Filosofía Medieval</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body {
            font-family: 'Georgia', serif;
            line-height: 1.7;
            color: #2c3e50;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 20px;
        }

        h1 {
            font-size: 2.8rem;
            color: #34495e;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .user-info-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .user-info-form input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .user-info-form input:focus {
            outline: none;
            border-color: #4169E1;
        }

        .question {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            border-left: 5px solid #4169E1;
        }

        .question p {
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .options label {
            display: block;
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .options label:hover {
            background-color: #dee2e6;
            transform: translateX(5px);
        }

        .options input[type="radio"] {
            margin-right: 10px;
        }

        .submit-btn, .download-btn {
            display: block;
            width: 100%;
            padding: 18px;
            font-size: 1.3rem;
            font-weight: bold;
            color: white;
            background: linear-gradient(135deg, #4169E1, #2F4F4F);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 30px;
        }

        .submit-btn:hover, .download-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(65, 105, 225, 0.4);
        }

        .result-container {
            text-align: center;
            padding: 30px;
            margin-top: 40px;
            border-radius: 15px;
            background: #f8f9fa;
            border: 2px solid #4169E1;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .download-btn {
            display: none; /* Oculto por defecto */
            background: linear-gradient(135deg, #28a745, #218838);
        }
        
        .download-btn:hover {
            box-shadow: 0 10px 20px rgba(40, 167, 69, 0.4);
        }

        .floating-home-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #4169E1, #2F4F4F);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 8px 25px rgba(65, 105, 225, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .floating-home-btn:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 15px 40px rgba(65, 105, 225, 0.6);
        }

        .floating-home-btn::before {
            content: '🏠';
            font-size: 1.3rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Evaluación de Filosofía Medieval</h1>
            <p>El Arte y la Música en el Pensamiento Cristiano</p>
        </header>
        <div id="attempts-counter" style="text-align: right; color: #555; margin-bottom: 20px;"></div>

        <form id="userInfo" class="user-info-form">
            <input type="text" id="nombre" name="nombre" placeholder="Nombre(s)" required>
            <input type="text" id="apellido" name="apellido" placeholder="Apellido(s)" required>
            <input type="text" id="carrera" name="carrera" placeholder="Carrera o Instrumento" required>
        </form>

        <div id="quiz-container"></div>

        <div id="navigation-container" style="display: flex; justify-content: space-between; margin-top: 30px;">
            <button id="prev-btn" class="submit-btn" style="width: 48%; background: linear-gradient(135deg, #6c757d, #5a6268);">Anterior</button>
            <button id="next-btn" class="submit-btn" style="width: 48%;">Siguiente</button>
        </div>

        <div id="result-container" style="display: none;"></div>
        
        <button id="download-btn" class="download-btn">Descargar Certificado de Resultados</button>
    </div>

    <a href="index.html" class="floating-home-btn" title="Volver al inicio"></a>

    <canvas id="result-canvas" width="800" height="600" style="display:none;"></canvas>

    <script>
        const quizData = [
            {
                question: "¿Qué filósofo definió la música como 'scientia bene modulandi' (la ciencia del buen modular) en su obra 'De Musica'?",
                options: ["Santo Tomás de Aquino", "Boecio", "San Agustín de Hipona", "Pseudo-Dionisio"],
                answer: 2
            },
            {
                question: "Las tres condiciones de la belleza según Santo Tomás de Aquino son:",
                options: ["Fe, Esperanza y Caridad", "Ritmo, Melodía y Armonía", "Integritas, Proportio y Claritas", "Mimesis, Catarsis y Anamnesis"],
                answer: 2
            },
            {
                question: "La estética de la luz divina, que concibe la belleza como irradiación de lo divino e influyó en el arte gótico, fue desarrollada por:",
                options: ["San Agustín", "Pseudo-Dionisio Areopagita", "Santo Tomás de Aquino", "Guido de Arezzo"],
                answer: 1
            },
            {
                question: "Para San Agustín, la belleza musical en la tierra es un 'vestigium Dei', que significa:",
                options: ["Una ciencia matemática", "Un eco de la armonía celestial", "Una huella de la belleza divina", "Un placer para los sentidos"],
                answer: 2
            },
            {
                question: "Santo Tomás de Aquino integró la filosofía de qué pensador antiguo en su teología cristiana para explicar la belleza?",
                options: ["Platón", "Aristóteles", "Pitágoras", "Plotino"],
                answer: 1
            },
            {
                question: "La idea de que la música terrenal debe imitar la armonía de los coros angélicos es central en el pensamiento de:",
                options: ["Pseudo-Dionisio Areopagita", "San Agustín", "Boecio", "Santo Tomás de Aquino"],
                answer: 0
            },
            {
                question: "En la estética de Santo Tomás, la 'Claritas' se refiere a:",
                options: ["La proporción entre las partes", "La completitud de la forma", "La luminosidad que hace resplandecer la forma", "La corrección teológica"],
                answer: 2
            },
            {
                question: "¿Qué autor medieval es fundamental por transmitir la teoría musical griega al mundo latino con su obra 'De Institutione Musica'?",
                options: ["Casiodoro", "San Gregorio Magno", "Boecio", "Alcuino de York"],
                answer: 2
            },
            {
                question: "El proceso anagógico, donde los elementos musicales elevan el espíritu a realidades superiores, es un concepto clave en:",
                options: ["La Summa Theologiae de Tomás de Aquino", "Las Confesiones de San Agustín", "La obra de Pseudo-Dionisio", "El Ars Nova"],
                answer: 2
            },
            {
                question: "San Agustín, en 'De Musica', describe una ascensión espiritual que va desde el placer sensible hasta la contemplación de:",
                options: ["La habilidad del músico", "La Belleza eterna e inmutable en Dios", "La estructura matemática del cosmos", "El silencio absoluto"],
                answer: 1
            },
            {
                question: "La filosofía tomista influyó profundamente en el desarrollo de:",
                options: ["La música profana de los trovadores", "El canto gregoriano y la polifonía sacra", "La música militar", "La danza cortesana"],
                answer: 1
            },
            {
                question: "La 'vía negativa musical', que sugiere que la música más perfecta conduce al silencio contemplativo, es una idea de:",
                options: ["Santo Tomás de Aquino", "San Agustín", "Guillermo de Ockham", "Pseudo-Dionisio Areopagita"],
                answer: 3
            },
            {
                question: "¿Cuál de los 'seis géneros de números musicales' de San Agustín corresponde a los que son conservados en la memoria?",
                options: ["Números sonantes", "Números progressores", "Números recordabiles", "Números judiciales"],
                answer: 2
            },
            {
                question: "La concepción de las catedrales góticas como 'instrumentos musicales gigantescos' se inspira en la estética de:",
                options: ["San Agustín", "Santo Tomás de Aquino", "Pseudo-Dionisio", "Boecio"],
                answer: 2
            },
            {
                question: "El 'Ars Nova' del siglo XIV representó:",
                options: ["Una confirmación de las reglas de San Agustín", "Un retorno a la música de la antigua Grecia", "Una crisis del pensamiento musical medieval con nuevas concepciones rítmicas", "La prohibición de la polifonía"],
                answer: 2
            }
        ];

        const quizContainer = document.getElementById('quiz-container');
        const resultContainer = document.getElementById('result-container');
        const downloadBtn = document.getElementById('download-btn');
        const userInfoForm = document.getElementById('userInfo');
        const nextBtn = document.getElementById('next-btn');
        const prevBtn = document.getElementById('prev-btn');
        const navigationContainer = document.getElementById('navigation-container');
        const attemptsCounter = document.getElementById('attempts-counter');

        const attemptsKey = 'medievalQuizAttempts';
        let currentQuestionIndex = 0;
        const userAnswers = new Array(quizData.length).fill(null);

        function displayQuestion() {
            const currentQuestion = quizData[currentQuestionIndex];
            quizContainer.innerHTML = ''; // Clear previous question

            const questionDiv = document.createElement('div');
            questionDiv.classList.add('question');
            
            const progressText = document.createElement('div');
            progressText.innerText = `Pregunta ${currentQuestionIndex + 1} de ${quizData.length}`;
            progressText.style.textAlign = 'center';
            progressText.style.marginBottom = '20px';
            progressText.style.fontSize = '1.1rem';
            progressText.style.color = '#555';
            questionDiv.appendChild(progressText);

            const questionText = document.createElement('p');
            questionText.innerText = currentQuestion.question;
            questionDiv.appendChild(questionText);

            const optionsDiv = document.createElement('div');
            optionsDiv.classList.add('options');

            currentQuestion.options.forEach((option, index) => {
                const label = document.createElement('label');
                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.name = `question${currentQuestionIndex}`;
                radio.value = index;
                if (userAnswers[currentQuestionIndex] === index) {
                    radio.checked = true;
                }
                radio.addEventListener('change', () => {
                    userAnswers[currentQuestionIndex] = parseInt(radio.value, 10);
                    if (currentQuestionIndex < quizData.length - 1) {
                        setTimeout(() => {
                            currentQuestionIndex++;
                            displayQuestion();
                        }, 300);
                    }
                });
                label.appendChild(radio);
                label.append(option);
                optionsDiv.appendChild(label);
            });

            questionDiv.appendChild(optionsDiv);
            quizContainer.appendChild(questionDiv);

            prevBtn.style.display = currentQuestionIndex === 0 ? 'none' : 'inline-block';
            nextBtn.style.display = 'inline-block';

            if (currentQuestionIndex === quizData.length - 1) {
                nextBtn.innerText = 'Calcular Resultados';
            } else {
                nextBtn.innerText = 'Siguiente';
            }
        }

        function handleNext() {
            if (userAnswers[currentQuestionIndex] === null) {
                Swal.fire({
                    title: 'Espera',
                    text: 'Por favor, selecciona una respuesta.',
                    icon: 'warning',
                    confirmButtonText: 'Entendido'
                });
                return;
            }

            if (currentQuestionIndex < quizData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                showResults();
            }
        }

        function handlePrev() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function showResults() {
            if (!userInfoForm.checkValidity()) {
                Swal.fire({
                    title: 'Datos Incompletos',
                    text: 'Por favor, completa todos tus datos (Nombre, Apellido y Carrera/Instrumento) para poder ver tus resultados.',
                    icon: 'warning',
                    confirmButtonText: 'Entendido'
                });
                return;
            }

            let attempts = parseInt(localStorage.getItem(attemptsKey) || '0', 10);
            attempts++;
            localStorage.setItem(attemptsKey, attempts);

            let score = 0;
            const answerDetails = [];
            quizData.forEach((currentQuestion, questionNumber) => {
                const isCorrect = userAnswers[questionNumber] === currentQuestion.answer;
                if (isCorrect) {
                    score++;
                }
                answerDetails.push({
                    question: currentQuestion.question,
                    userAnswer: userAnswers[questionNumber] !== null ? currentQuestion.options[userAnswers[questionNumber]] : 'No respondida',
                    correctAnswer: currentQuestion.options[currentQuestion.answer],
                    isCorrect: isCorrect
                });
            });

            userInfoForm.style.display = 'none';
            quizContainer.style.display = 'none';
            navigationContainer.style.display = 'none';
            attemptsCounter.style.display = 'none';

            resultContainer.innerHTML = `<h2>Resultados Finales</h2><p>Tu puntaje es: ${score} de ${quizData.length}</p>`;
            
            const detailsDiv = document.createElement('div');
            detailsDiv.style.textAlign = 'left';
            detailsDiv.style.marginTop = '30px';
            
            answerDetails.forEach((detail, index) => {
                const detailEl = document.createElement('div');
                detailEl.style.borderLeft = `5px solid ${detail.isCorrect ? '#28a745' : '#dc3545'}`;
                detailEl.style.padding = '10px';
                detailEl.style.marginBottom = '10px';
                detailEl.style.background = '#f9f9f9';
                
                detailEl.innerHTML = `
                    <p style="font-weight: bold; font-size: 1.1rem; margin-bottom: 10px;">${index + 1}. ${detail.question}</p>
                    <p style="color: ${detail.isCorrect ? '#2c3e50' : '#dc3545'};">Tu respuesta: ${detail.userAnswer}</p>
                    ${!detail.isCorrect ? `<p style="color: #28a745;">Respuesta correcta: ${detail.correctAnswer}</p>` : ''}
                `;
                detailsDiv.appendChild(detailEl);
            });
            
            resultContainer.appendChild(detailsDiv);

            resultContainer.style.display = 'block';
            downloadBtn.style.display = 'block';
        }
        
        function downloadResultImage() {
            const canvas = document.getElementById('result-canvas');
            const ctx = canvas.getContext('2d');
            
            const nombre = document.getElementById('nombre').value;
            const apellido = document.getElementById('apellido').value;
            const carrera = document.getElementById('carrera').value;
            const scoreText = resultContainer.querySelector('p').innerText;
            const score = (scoreText.match(/(\d+)/) || [])[0] || '0';

            const grd = ctx.createLinearGradient(0, 0, 800, 600);
            grd.addColorStop(0, '#a1c4fd');
            grd.addColorStop(1, '#c2e9fb');
            ctx.fillStyle = grd;
            ctx.fillRect(0, 0, 800, 600);

            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 48px Georgia';
            ctx.textAlign = 'center';
            ctx.fillText('Certificado de Evaluación', 400, 100);
            
            ctx.font = '32px Georgia';
            ctx.fillText('Filosofía Medieval', 400, 150);

            ctx.strokeStyle = '#2c3e50';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(100, 180);
            ctx.lineTo(700, 180);
            ctx.stroke();

            ctx.fillStyle = '#34495e';
            ctx.font = '28px Georgia';
            ctx.textAlign = 'left';
            ctx.fillText(`Estudiante: ${nombre} ${apellido}`, 100, 250);
            ctx.fillText(`Carrera/Instrumento: ${carrera}`, 100, 300);

            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 72px Georgia';
            ctx.textAlign = 'center';
            ctx.fillText('Calificación Obtenida', 400, 420);
            
            ctx.fillStyle = '#4169E1';
            ctx.font = 'bold 90px Georgia';
            ctx.fillText(`${score}/${quizData.length}`, 400, 520);

            const link = document.createElement('a');
            link.download = `Certificado_Medieval_${apellido}_${nombre}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        function initializeQuiz() {
            let attempts = parseInt(localStorage.getItem(attemptsKey) || '0', 10);
            if (attempts >= 2) {
                userInfoForm.style.display = 'none';
                quizContainer.style.display = 'none';
                navigationContainer.style.display = 'none';
                attemptsCounter.style.display = 'none';
                resultContainer.style.display = 'block';
                resultContainer.innerHTML = '<h2>Límite de Intentos Alcanzado</h2><p>Has completado esta evaluación el número máximo de veces permitido (2).</p>';
                Swal.fire({
                    title: 'Límite de Intentos',
                    text: 'Ya has realizado esta evaluación dos veces.',
                    icon: 'error',
                    confirmButtonText: 'Entendido'
                });
            } else {
                attemptsCounter.innerText = `Intento ${attempts + 1} de 2.`;
                displayQuestion();
            }
        }

        nextBtn.addEventListener('click', handleNext);
        prevBtn.addEventListener('click', handlePrev);
        downloadBtn.addEventListener('click', downloadResultImage);

        initializeQuiz();
    </script>
</body>
</html>
